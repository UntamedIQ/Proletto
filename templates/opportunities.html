<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Opportunities - Proletto</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="/static/css/tooltips.css">
    <link rel="stylesheet" href="/static/css/feedback-widget.css">
    <link rel="stylesheet" href="/static/css/network-status.css">
    <link rel="stylesheet" href="/static/css/mobile.css">
    <link rel="stylesheet" href="/static/css/lazy-load.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="/static/js/network-status.js" defer></script>
    <script src="/static/js/lazy-load-components.js" defer></script>
    <style>
        /* Base styles for opportunities page */
        .opportunities-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            font-family: 'Playfair Display', serif;
            color: #8B4513;
            margin-bottom: 10px;
        }
        
        .page-header p {
            font-size: 1.1rem;
            color: #666;
            max-width: 700px;
            margin: 0 auto 15px;
        }
        
        .ai-feature-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(90deg, #904E95 0%, #E84B63 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(232, 75, 99, 0.3);
            margin: 5px auto 10px;
            transition: transform 0.2s, box-shadow 0.3s;
            animation: pulse 2s infinite;
        }
        
        .ai-feature-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(232, 75, 99, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(232, 75, 99, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(232, 75, 99, 0); }
            100% { box-shadow: 0 0 0 0 rgba(232, 75, 99, 0); }
        }
        
        .ai-icon {
            font-size: 1.2rem;
            margin-right: 8px;
        }
        
        /* Dashboard layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            margin-top: 30px;
        }
        
        /* Sidebar styles */
        .sidebar {
            position: sticky;
            top: 20px;
            align-self: start;
        }
        
        .membership-panel {
            background-color: #FFF8E1;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .membership-panel h3 {
            margin-top: 0;
            color: #8B4513;
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
            padding-bottom: 8px;
        }
        
        .current-level {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .level-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-left: 8px;
            background-color: #E3F2FD;
            color: #1976D2;
        }
        
        .upgrade-button {
            display: block;
            width: 100%;
            text-align: center;
            background-color: #E67E22;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 15px;
        }
        
        .upgrade-button:hover {
            background-color: #D35400;
            transform: translateY(-2px);
        }
        
        .filter-panel {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .filter-panel h3 {
            margin-top: 0;
            color: #8B4513;
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
            padding-bottom: 8px;
        }
        
        .filter-section {
            margin-bottom: 20px;
        }
        
        .filter-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 0.95rem;
        }
        
        .search-box, .filter-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .search-box:focus, .filter-select:focus {
            border-color: #a86a3e;
            outline: none;
            box-shadow: 0 0 0 3px rgba(168, 106, 62, 0.1);
        }
        
        /* Main content area */
        .main-content {
            min-height: 500px;
        }
        
        .stats-container {
            background-color: white;
            border-radius: 12px;
            padding: 22px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        
        .stats-container h3 {
            margin-top: 0;
            color: #8B4513;
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.1);
            padding-bottom: 8px;
        }
        
        .stats-container ul {
            list-style: none;
            padding: 0;
            margin: 15px 0 5px;
        }
        
        .stats-container li {
            padding: 5px 0;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .stats-container li span:first-child {
            color: #666;
        }
        
        .stats-container li span:last-child {
            font-weight: 600;
            color: #8B4513;
        }
        
        /* Opportunities display */
        /* Preview message for non-registered users */
        .preview-message {
            background-color: #FFF8E1;
            border-left: 4px solid #FFC107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .preview-message h3 {
            margin-top: 0;
            color: #F57C00;
        }
        
        .preview-message p {
            margin-bottom: 15px;
        }
        
        .preview-message .signup-button {
            background-color: #F57C00;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .preview-message .signup-button:hover {
            background-color: #E65100;
        }
        
        /* Highlight animation for signup form */
        @keyframes highlightSignup {
            0% { box-shadow: 0 0 0 0 rgba(245, 124, 0, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(245, 124, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 124, 0, 0); }
        }
        
        .highlight-signup {
            animation: highlightSignup 1.5s ease-out;
        }
        
        .opportunity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 22px;
        }
        
        .opportunity-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .opportunity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }
        
        .card-header {
            padding: 18px 20px 8px;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }
        
        .opportunity-source {
            font-size: 13px;
            color: #888;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .source-state {
            font-weight: 600;
            color: #E67E22;
            margin-left: 5px;
        }
        
        .premium-indicator {
            background-color: #FFF3E0;
            color: #E67E22;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 8px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .card-body {
            padding: 16px 20px;
            flex-grow: 1;
        }
        
        .opportunity-title {
            margin: 0 0 15px 0;
            font-size: 1.25rem;
            color: #333;
            line-height: 1.4;
        }
        
        .opportunity-location {
            display: inline-block;
            background-color: #f8f3e6;
            color: #8c562e;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 13px;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .opportunity-description {
            font-size: 0.95rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Opportunity image styles */
        .opportunity-image {
            width: 100%;
            height: 180px; /* fixed height for consistency */
            overflow: hidden;
            position: relative;
            background-color: #f8f3e6; /* matches theme */
        }
        
        .opportunity-image img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* maintains aspect ratio while filling container */
            transition: transform 0.3s ease;
        }
        
        .opportunity-card:hover .opportunity-image img {
            transform: scale(1.05); /* subtle zoom effect on hover */
        }
        
        .opportunity-image.placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f3e6;
        }
        
        .opportunity-image.placeholder img {
            opacity: 0.7;
        }
        
        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .opportunity-image {
                height: 160px;
            }
            
            .opportunity-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .opportunity-image {
                height: 140px;
            }
            
            .opportunity-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card-footer {
            padding: 15px 20px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fafafa;
        }
        
        .opportunity-meta {
            font-size: 13px;
            color: #888;
        }
        
        .opportunity-link {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(90deg, #904E95 0%, #E84B63 100%);
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s, transform 0.2s;
            position: relative;
            box-shadow: 0 4px 10px rgba(232, 75, 99, 0.2);
        }
        
        .opportunity-link:hover {
            background: linear-gradient(90deg, #7b3b7e 0%, #d43853 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(232, 75, 99, 0.3);
        }
        
        .button-text {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
        }
        
        .button-text::before {
            content: "🤖";
            font-size: 14px;
            margin-right: 6px;
        }
        
        .opportunity-link::after {
            content: "AI-POWERED";
            position: absolute;
            top: -8px;
            right: -5px;
            background: linear-gradient(90deg, #E84B63 0%, #904E95 100%);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Premium content styling */
        .locked-content {
            position: relative;
        }
        
        .locked-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.7);
            z-index: 2;
            border-radius: 12px;
        }
        
        .locked-content::after {
            content: "🔒";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            z-index: 3;
        }
        
        /* Email signup requirement */
        .blurred-content {
            filter: blur(5px);
            user-select: none;
            pointer-events: none;
        }
        
        .signup-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            padding: 20px;
            text-align: center;
        }
        
        .signup-overlay h3 {
            margin-top: 0;
            color: #E67E22;
            margin-bottom: 15px;
        }
        
        .signup-overlay p {
            margin-bottom: 20px;
            color: #555;
            max-width: 400px;
        }
        
        .signup-form {
            display: flex;
            max-width: 400px;
            width: 100%;
            margin-bottom: 5px;
        }
        
        .email-input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-right: none;
            border-radius: 6px 0 0 6px;
            font-size: 16px;
        }
        
        .email-input:focus {
            outline: none;
            border-color: #E67E22;
        }
        
        .signup-button {
            padding: 10px 20px;
            background-color: #E67E22;
            color: white;
            border: none;
            border-radius: 0 6px 6px 0;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .signup-button:hover {
            background-color: #D35400;
        }
        
        /* Social media signup styles */
        .social-signup {
            margin-top: 20px;
            width: 100%;
            max-width: 400px;
        }
        
        .or-divider {
            display: flex;
            align-items: center;
            text-align: center;
            color: #999;
            font-size: 14px;
            margin: 15px 0;
        }
        
        .or-divider::before,
        .or-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #ddd;
        }
        
        .or-divider::before {
            margin-right: 10px;
        }
        
        .or-divider::after {
            margin-left: 10px;
        }
        
        .social-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .social-button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            font-size: 14px;
        }
        
        .social-button img {
            height: 18px;
            margin-right: 8px;
        }
        
        .google-button {
            background-color: white;
            color: #444;
            border: 1px solid #ddd;
        }
        
        .google-button:hover {
            background-color: #f8f8f8;
        }
        
        .facebook-button {
            background-color: #4267B2;
        }
        
        .facebook-button:hover {
            background-color: #365899;
        }
        
        .instagram-button {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }
        
        .instagram-button:hover {
            opacity: 0.9;
        }
        
        .openai-button {
            background-color: white;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .openai-button:hover {
            background-color: #f8f8f8;
        }
        
        .openai-button img {
            height: 16px;
            margin-right: 8px;
        }
        
        .locked-message {
            background: linear-gradient(165deg, #fdfbf6 0%, #fff8e1 100%);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin-bottom: 25px;
            border: 1px solid #FFE0B2;
            box-shadow: 0 10px 25px rgba(232, 75, 99, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .locked-message::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(232, 75, 99, 0.05) 0%, rgba(144, 78, 149, 0.02) 70%, transparent 100%);
            top: -150px;
            right: -150px;
            border-radius: 50%;
            z-index: 0;
        }
        
        .locked-message h3 {
            color: #904E95;
            margin-top: 0;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .locked-message p {
            margin-bottom: 20px;
            color: #666;
            position: relative;
            z-index: 1;
        }
        
        /* AI Features Styling */
        .ai-feature-large {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        .ai-icon-large {
            font-size: 48px;
            display: block;
            margin: 0 auto 10px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .ai-feature-large h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            background: linear-gradient(90deg, #904E95 0%, #E84B63 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 5px 0 10px;
            position: relative;
        }
        
        .ai-feature-tag {
            position: absolute;
            top: 0;
            right: 20%;
            background: linear-gradient(90deg, #E84B63 0%, #904E95 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: bold;
            letter-spacing: 1px;
            transform: rotate(15deg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .ai-features-list {
            text-align: left;
            max-width: 500px;
            margin: 0 auto 25px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            position: relative;
            z-index: 1;
        }
        
        .ai-feature-item {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            font-weight: 500;
            color: #333;
        }
        
        .ai-check {
            color: #E84B63;
            margin-right: 10px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .ai-signup-text {
            font-weight: 600;
            color: #904E95;
            margin: 20px auto;
            max-width: 500px;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        /* Group header */
        .group-header {
            margin: 35px 0 15px;
            color: #8B4513;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
        }
        
        /* Loading and error states */
        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
            font-style: italic;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .error {
            background-color: #FFEBEE;
            color: #C62828;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #FFCDD2;
        }
        
        /* Responsive adjustments */
        @media (max-width: 900px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                margin-bottom: 30px;
            }
            
            .filter-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 600px) {
            .opportunity-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-panel {
                display: block;
            }
            
            .page-header h1 {
                font-size: 1.8rem;
            }
            
            .signup-form {
                flex-direction: column;
            }
            
            .email-input {
                border-radius: 6px;
                border-right: 1px solid #ccc;
                margin-bottom: 10px;
            }
            
            .signup-button {
                border-radius: 6px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <a href="/" aria-label="Proletto Home">
                    <img src="assets/proletto-logo.svg" alt="Proletto - Opportunities for Visual Artists" class="main-logo" width="220" height="60" loading="eager">
                </a>
            </div>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/how-it-works">How It Works</a></li>
                <li><a href="/opportunities" class="active">Opportunities</a></li>
                <li><a href="/membership">Membership</a></li>
            </ul>
        </nav>
    </header>

    <main class="opportunities-container">
        <div class="page-header">
            <h1>Art Opportunities</h1>
            <p>Discover the latest curated opportunities for visual artists, including grants, residencies, exhibitions, and jobs.</p>
            <div class="ai-feature-badge">
                <span class="ai-icon">🤖</span> <span data-ai-tooltip="application-autofill" data-tooltip-position="bottom">World's First AI-Powered Auto-Submit Technology</span>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <!-- Sidebar with filters and membership info -->
            <div class="sidebar">
                <div class="membership-panel">
                    <h3>Your Membership</h3>
                    <div class="current-level">
                        Current level: <span class="level-indicator">Free</span>
                    </div>
                    <p>Upgrade for access to state-specific engines and premium opportunities.</p>
                    <a href="/membership" class="upgrade-button">Upgrade Membership</a>
                </div>
                
                <div class="filter-panel">
                    <h3>Filter Opportunities</h3>
                    
                    <div class="filter-section">
                        <label for="search-box">Search:</label>
                        <input type="text" id="search-box" class="search-box" placeholder="Keywords or phrases...">
                    </div>
                    
                    <div class="filter-section">
                        <label for="state-filter">Location Engine:</label>
                        <select id="state-filter" class="filter-select">
                            <option value="">All Locations</option>
                            <option value="social_media" data-membership="free">National (Social Media)</option>
                            <optgroup label="Daily Updated States">
                                <option value="california" data-membership="supporter">California</option>
                                <option value="new_york" data-membership="supporter">New York</option>
                                <option value="texas" data-membership="supporter">Texas</option>
                                <option value="illinois" data-membership="supporter">Illinois</option>
                                <option value="florida" data-membership="supporter">Florida</option>
                            </optgroup>
                            <optgroup label="Weekly Updated States">
                                <option value="washington" data-membership="supporter">Washington</option>
                                <option value="colorado" data-membership="supporter">Colorado</option>
                                <option value="massachusetts" data-membership="supporter">Massachusetts</option>
                                <option value="oregon" data-membership="supporter">Oregon</option>
                                <option value="pennsylvania" data-membership="supporter">Pennsylvania</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="filter-section">
                        <label for="category-filter">Category:</label>
                        <select id="category-filter" class="filter-select">
                            <option value="">All Categories</option>
                            
                            <!-- Design Jobs -->
                            <optgroup label="Design">
                                <option value="designer">Designer</option>
                                <option value="graphic designer">Graphic Designer</option>
                                <option value="ui designer">UI Designer</option>
                                <option value="ux designer">UX Designer</option>
                                <option value="art director">Art Director</option>
                                <option value="creative director">Creative Director</option>
                            </optgroup>
                            
                            <!-- Fine Art -->
                            <optgroup label="Fine Art">
                                <option value="artist">Artist</option>
                                <option value="sculptor">Sculptor</option>
                                <option value="painter">Painter</option>
                                <option value="studio assistant">Studio Assistant</option>
                                <option value="public art">Public Art</option>
                                <option value="installation">Installation Artist</option>
                            </optgroup>
                            
                            <!-- Grants & Residencies -->
                            <optgroup label="Grants & Residencies">
                                <option value="grant">Grants</option>
                                <option value="residency">Artist Residency</option>
                                <option value="fellowship">Fellowship</option>
                                <option value="artist in residence">Artist in Residence</option>
                                <option value="commission">Public Art Commission</option>
                                <option value="funding">Artist Funding</option>
                                <option value="award">Art Award</option>
                            </optgroup>
                            
                            <!-- Education -->
                            <optgroup label="Education">
                                <option value="educator">Art Educator</option>
                                <option value="professor">Professor</option>
                                <option value="teacher">Teacher</option>
                                <option value="teaching artist">Teaching Artist</option>
                            </optgroup>
                            
                            <!-- Museums & Galleries -->
                            <optgroup label="Museums & Galleries">
                                <option value="curator">Curator</option>
                                <option value="gallery">Gallery Jobs</option>
                                <option value="museum">Museum Jobs</option>
                                <option value="exhibit designer">Exhibition Designer</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="filter-section">
                        <label for="location-filter">City:</label>
                        <select id="location-filter" class="filter-select">
                            <option value="">All Cities</option>
                            <option value="remote">Remote</option>
                            <option value="hybrid">Hybrid</option>
                            
                            <!-- Major Cities by State -->
                            <optgroup label="Major Cities">
                                <option value="new york city">New York City</option>
                                <option value="los angeles">Los Angeles</option>
                                <option value="chicago">Chicago</option>
                                <option value="san francisco">San Francisco</option>
                                <option value="boston">Boston</option>
                                <option value="seattle">Seattle</option>
                                <option value="austin">Austin</option>
                                <option value="miami">Miami</option>
                                <option value="denver">Denver</option>
                                <option value="portland">Portland</option>
                                <option value="philadelphia">Philadelphia</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Main content area -->
            <div class="main-content">
                <div class="stats-container" id="stats-container">
                    <h3>Opportunity Statistics</h3>
                    <p>Loading statistics...</p>
                </div>
                
                <!-- Email signup overlay for non-registered users -->
                <div id="signup-container" class="locked-message">
                    <div class="ai-feature-large">
                        <span class="ai-icon-large">🤖</span>
                        <h2>Proletto AI Technology</h2>
                        <div class="ai-feature-tag">WORLD FIRST</div>
                    </div>
                    
                    <h3>Sign Up to Access Revolutionary AI Features</h3>
                    
                    <div class="ai-features-list">
                        <div class="ai-feature-item">
                            <span class="ai-check">✓</span> <span data-ai-tooltip="application-autofill" data-tooltip-position="right">AI-Powered Auto-Submit Application Technology</span>
                        </div>
                        <div class="ai-feature-item">
                            <span class="ai-check">✓</span> <span data-ai-tooltip="opportunity-match" data-tooltip-position="right">AI Portfolio Analysis & Opportunity Matching</span>
                        </div>
                        <div class="ai-feature-item">
                            <span class="ai-check">✓</span> <span data-ai-tooltip="portfolio-analysis" data-tooltip-position="right">Intelligent Application Tracking System</span>
                        </div>
                        <div class="ai-feature-item">
                            <span class="ai-check">✓</span> <span data-ai-tooltip="application-tips" data-tooltip-position="right">Personalized AI Grant Writing Assistant</span>
                        </div>
                    </div>
                    
                    <p class="ai-signup-text">Join over 5,000 artists leveraging Proletto's AI to win more grants, residencies and exhibitions.</p>
                    
                    <form id="signup-form" class="signup-form">
                        <input type="email" id="email-input" class="email-input" placeholder="Your email address" required>
                        <button type="submit" class="signup-button">Get AI Access</button>
                    </form>
                    
                    <div class="social-signup">
                        <p class="or-divider"><span>or sign up with</span></p>
                        <div class="social-buttons">
                            <button id="google-signup" class="social-button google-button">
                                <img src="/assets/google-logo.svg" alt="Google Logo" width="18" height="18" loading="lazy">
                                Google
                            </button>
                            <button id="facebook-signup" class="social-button facebook-button">
                                <img src="/assets/facebook-logo.svg" alt="Facebook Logo">
                                Facebook
                            </button>
                            <button id="instagram-signup" class="social-button instagram-button">
                                <img src="/assets/instagram-logo.svg" alt="Instagram Logo">
                                @proletto.app
                            </button>
                            <button id="openai-signup" class="social-button openai-button">
                                <img src="/assets/openai-logo.svg" alt="OpenAI Logo">
                                OpenAI
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="opportunities-list">
                    <p class="loading">Loading opportunities...</p>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Proletto</h3>
                <p>Proletto is a platform designed to connect visual artists with professional opportunities.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/how-it-works">How It Works</a></li>
                    <li><a href="/opportunities">Opportunities</a></li>
                    <li><a href="/membership">Membership</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                <p>Email: support@myproletto.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Proletto. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Use location.protocol to ensure it works on both http and https
        // Use relative paths to API endpoints to leverage our enhanced API proxy
        // The proxy in main.py will handle routing to the API backend
        // This avoids CORS issues and adds enhanced error handling and retry mechanisms
        let OPPORTUNITIES_URL, STATS_URL;
        
        // Use direct routes for opportunities instead of proxy
        // This provides better reliability through multiple fallbacks
        // Direct endpoint with Redis caching and snapshot fallback
        OPPORTUNITIES_URL = '/opportunities/';
        STATS_URL = '/opportunities/status';
        console.log('Using direct opportunities endpoints for maximum reliability');
        
        console.log('Opportunities endpoints configured:', { 
            OPPORTUNITIES_URL,
            STATS_URL
        });
        
        // Utility function to fetch with retry and exponential backoff
        // Emits a custom 'fetchRetry' event when retrying for UI updates
        async function fetchWithRetry(url, options = {}, retries = 2, backoff = 300, attempt = 1) {
            try {
                const fetchPromise = fetch(url, {
                    ...options,
                    credentials: 'same-origin' // Ensure cookies are sent
                });
                
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Request timed out')), options.timeout || 10000)
                );
                
                const res = await Promise.race([fetchPromise, timeoutPromise]);
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                
                // Try to parse as JSON first
                const text = await res.text();
                try {
                    return JSON.parse(text);
                } catch (e) {
                    // If not JSON, return text
                    return text;
                }
            } catch (err) {
                console.error(`Fetch error (retries left: ${retries}):`, err.message);
                
                if (retries > 0) {
                    // Wait with exponential backoff
                    await new Promise(r => setTimeout(r, backoff));
                    
                    // Emit a custom event to update UI with retry progress
                    const retryEvent = new CustomEvent('fetchRetry', {
                        detail: {
                            url: url,
                            retries: retries,
                            attempt: attempt,
                            error: err.message,
                            backoff: backoff
                        }
                    });
                    document.dispatchEvent(retryEvent);
                    
                    console.log(`Retrying fetch to ${url} (${retries} retries left, attempt ${attempt + 1}, next backoff: ${backoff * 2}ms)`);
                    
                    // Show retry UI message
                    if (url.includes('/opportunities')) {
                        document.getElementById('opportunities-list').innerHTML = `
                            <div class="loading-container">
                                <div class="loading-spinner"></div>
                                <p>Retrying connection (attempt ${attempt + 1} of ${attempt + retries})...</p>
                                <small>Please wait while we try to connect to the server.</small>
                            </div>
                        `;
                    }
                    
                    return fetchWithRetry(url, options, retries - 1, backoff * 2, attempt + 1);
                }
                throw err;
            }
        }

        // Simulated user subscription status
        let userSubscription = {
            isRegistered: false, // Whether the user has signed up with email
            membershipLevel: "free", // Options: "free", "supporter", "premium"
            chosenStates: [], // For supporter level, would contain 3 chosen states
            email: '',
            signupMethod: '' // 'email', 'google', 'facebook', 'instagram'
        };
        
        // Check if user is already registered
        function checkRegistrationStatus() {
            // In a real app, this would check localStorage, cookies, or make an API call
            const savedEmail = localStorage.getItem('proletto_email');
            const signupMethod = localStorage.getItem('proletto_signup_method');
            
            if (savedEmail) {
                userSubscription.isRegistered = true;
                userSubscription.email = savedEmail;
                userSubscription.signupMethod = signupMethod || 'email';
                
                // Hide signup form and show opportunities
                document.getElementById('signup-container').style.display = 'none';
                fetchOpportunities({});
                fetchStats();
                
                // Update membership display
                document.querySelector('.level-indicator').textContent = 
                    userSubscription.membershipLevel.charAt(0).toUpperCase() + 
                    userSubscription.membershipLevel.slice(1);
                
                // In a production app, we'd validate the email with the backend here
                // and perform additional verification if needed
                
                console.log(`User already registered with ${userSubscription.signupMethod}: ${userSubscription.email}`);
            }
        }
        
        // Handle email signup form submission
        document.getElementById('signup-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const emailInput = document.getElementById('email-input');
            const email = emailInput.value.trim();
            
            if (email && validateEmail(email)) {
                // Check for potential fake/disposable email domains
                if (isSuspiciousEmail(email)) {
                    // For suspicious emails, we still allow access but might flag them in a real system
                    console.warn('Potentially suspicious email detected:', email);
                    // In a real app, you might show a verification step or additional captcha here
                }
                
                // Process the signup
                processSignup(email, 'email');
                
            } else {
                alert('Please enter a valid email address');
            }
        });
        
        // Handle social media signup buttons
        document.getElementById('google-signup').addEventListener('click', function() {
            // In a real app, this would open a Google OAuth popup
            simulateSocialSignup('google');
        });
        
        document.getElementById('facebook-signup').addEventListener('click', function() {
            // In a real app, this would open a Facebook OAuth popup
            simulateSocialSignup('facebook');
        });
        
        document.getElementById('instagram-signup').addEventListener('click', function() {
            // In a real app, this would open an Instagram OAuth popup
            simulateSocialSignup('instagram');
        });
        
        document.getElementById('openai-signup').addEventListener('click', function() {
            // In a real app, this would open an OpenAI OAuth popup
            simulateSocialSignup('openai');
        });
        
        // Simulate social media signup (for demo purposes)
        function simulateSocialSignup(provider) {
            // This is just for demonstration - in a real app, this would use proper OAuth
            const providerEmails = {
                'google': 'user@gmail.com',
                'facebook': 'user@facebook.com',
                'instagram': 'user@instagram.com',
                'openai': 'user@openai.com'
            };
            
            // Get a simulated email from the provider
            const email = providerEmails[provider];
            
            // In a real app, we'd get the user's actual email from the OAuth provider
            processSignup(email, provider);
            
            console.log(`User signed up with ${provider}: ${email}`);
        }
        
        // Process signup with any method (email or social)
        function processSignup(email, method) {
            // Save email and signup method
            localStorage.setItem('proletto_email', email);
            localStorage.setItem('proletto_signup_method', method);
            
            // Update subscription status
            userSubscription.isRegistered = true;
            userSubscription.email = email;
            userSubscription.signupMethod = method;
            
            // Hide signup form
            document.getElementById('signup-container').style.display = 'none';
            
            // Load opportunities
            fetchOpportunities({});
            fetchStats();
            
            // In a real app, you would:
            // 1. Submit this to your backend
            // 2. Check if it's a new or returning user
            // 3. Send a confirmation email for new email signups
            // 4. Potentially store initial data about the user's interests
            
            // For demo, log the method and email
            console.log(`User signed up with ${method}: ${email}`);
            
            // Record initial preferences
            recordInitialPreferences();
        }
        
        // Record initial user preferences and potentially scrape some basic data
        function recordInitialPreferences() {
            // In a real app, you might:
            // 1. Record the filter selections the user was viewing
            // 2. Note which type of opportunity they were interested in
            // 3. Record the referrer source or utm parameters
            // 4. Capture basic browser/device info for analytics
            
            // For demo purposes, we'll just store the current filter state
            const currentPreferences = {
                state: document.getElementById('state-filter').value,
                category: document.getElementById('category-filter').value,
                location: document.getElementById('location-filter').value,
                searchTerm: document.getElementById('search-box').value.trim(),
                joinedDate: new Date().toISOString(),
                browser: navigator.userAgent,
                screenSize: `${window.innerWidth}x${window.innerHeight}`
            };
            
            // Store the user preferences
            localStorage.setItem('proletto_user_preferences', JSON.stringify(currentPreferences));
            
            console.log('Recorded initial user preferences:', currentPreferences);
        }
        
        // Email validation helper
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Check for suspicious or disposable email domains
        function isSuspiciousEmail(email) {
            // List of common disposable email domains
            const disposableDomains = [
                'mailinator.com', 'tempmail.com', 'temp-mail.org', 'guerrillamail.com',
                'throwawaymail.com', '10minutemail.com', 'yopmail.com', 'trashmail.com',
                'sharklasers.com', 'dispostable.com', 'mailnesia.com', 'tempr.email',
                'getnada.com', 'tempinbox.com', 'mohmal.com', 'fakeinbox.com',
                'tempail.com', 'tempmailaddress.com', 'mailcatch.com', 'maildrop.cc'
            ];
            
            // Extract domain from email
            const domain = email.split('@')[1].toLowerCase();
            
            // Check if it's a disposable domain
            return disposableDomains.includes(domain);
        }
        
        // Function to fetch opportunities from the API with enhanced retry logic
        async function fetchOpportunities(filters = {}) {
            // Show a loading indicator
            document.getElementById('opportunities-list').innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <p>Loading opportunities...</p>
                </div>
            `;
            
            try {
                let url = OPPORTUNITIES_URL;
                
                // Add keyword filter if provided
                if (filters.keyword) {
                    url += `?keyword=${encodeURIComponent(filters.keyword)}`;
                }
                
                // Apply membership-based parameters
                if (!userSubscription.isRegistered) {
                    // For non-registered users, add a limit to show only a few opportunities
                    url += (filters.keyword ? '&' : '?') + 'limit=6';
                } else {
                    // Apply different limits and filters based on membership level
                    const params = [];
                    
                    // Add existing query parameters if any
                    if (filters.keyword) {
                        params.push(`keyword=${encodeURIComponent(filters.keyword)}`);
                    }
                    
                    if (userSubscription.membershipLevel === 'free') {
                        // Free users get limited opportunities (mostly social media)
                        params.push('limit=15');
                        params.push('tier=free');
                    } else if (userSubscription.membershipLevel === 'supporter') {
                        // Supporter users get more opportunities with their chosen states
                        params.push('limit=50');
                        params.push('tier=supporter');
                        
                        // Add chosen states if available
                        if (userSubscription.chosenStates && userSubscription.chosenStates.length > 0) {
                            userSubscription.chosenStates.forEach(state => {
                                params.push(`state=${encodeURIComponent(state)}`);
                            });
                        }
                    } else if (userSubscription.membershipLevel === 'premium') {
                        // Premium users get everything
                        params.push('tier=premium');
                    }
                    
                    // Add the parameters to the URL
                    if (params.length > 0) {
                        url += (url.includes('?') ? '&' : '?') + params.join('&');
                    }
                }
                
                console.log(`Fetching opportunities from: ${url}`);
                
                // Use our fetchWithRetry utility with better error handling
                const data = await fetchWithRetry(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    timeout: 15000, // 15-second timeout
                }, 3, 1000); // 3 retries starting with 1000ms backoff
                
                // This event listener is no longer needed since we handle it directly in the fetchWithRetry function
                // The code has been moved into the fetchWithRetry function for better synchronization
                
                if (data && data.success) {
                    if (!data.opportunities || !Array.isArray(data.opportunities)) {
                        console.error('API response missing opportunities array:', data);
                        throw new Error('API response format is invalid');
                    }
                    
                    let opportunities = data.opportunities;
                    console.log(`Loaded ${opportunities.length} opportunities`);
                    
                    // Apply client-side category filter if provided
                    if (filters.category && filters.category !== '') {
                        opportunities = opportunities.filter(opp => 
                            opp.title.toLowerCase().includes(filters.category.toLowerCase()) ||
                            (opp.description && opp.description.toLowerCase().includes(filters.category.toLowerCase()))
                        );
                    }
                    
                    // Apply client-side location filter if provided
                    if (filters.location && filters.location !== '') {
                        opportunities = opportunities.filter(opp => 
                            (opp.location && opp.location.toLowerCase().includes(filters.location.toLowerCase())) ||
                            opp.title.toLowerCase().includes(filters.location.toLowerCase()) ||
                            (opp.description && opp.description.toLowerCase().includes(filters.location.toLowerCase()))
                        );
                    }
                    
                    // Apply state-specific filter if provided
                    if (filters.state && filters.state !== '') {
                        if (filters.state === 'social_media') {
                            opportunities = opportunities.filter(opp => 
                                opp.type === 'social_media'
                            );
                        } else {
                            opportunities = opportunities.filter(opp => 
                                (opp.state && opp.state.toLowerCase().includes(filters.state.toLowerCase()))
                            );
                        }
                    }
                    
                    // Apply membership filtering
                    opportunities = applyMembershipFilters(opportunities, filters);
                    
                    // Display the filtered opportunities
                    displayOpportunities(opportunities, filters);
                } else {
                    console.error('API returned success: false -', data.message || 'No error message provided');
                    throw new Error(data.message || 'Failed to load opportunities');
                }
            } catch (error) {
                console.error('Error fetching opportunities after all retries:', error);
                
                // Show a user-friendly error with a retry button
                showError(`Failed to connect to the opportunities service: ${error.message}`);
            }
        }
        
        // Filter opportunities based on user membership level
        function applyMembershipFilters(opportunities, filters) {
            // Always show social media opportunities to everyone
            let accessibleOpportunities = opportunities.filter(opp => 
                opp.type === 'social_media' || !opp.membership_level || opp.membership_level === 'free'
            );
            
            if (userSubscription.membershipLevel === 'premium') {
                // Premium users can see everything
                return opportunities;
            } else if (userSubscription.membershipLevel === 'supporter') {
                // Supporter users can see their 3 chosen states plus social media
                const supporterOpportunities = opportunities.filter(opp => 
                    userSubscription.chosenStates.includes(opp.state)
                );
                return [...accessibleOpportunities, ...supporterOpportunities];
            } else {
                // Free users can only see social media opportunities
                return accessibleOpportunities;
            }
        }

        // Function to fetch stats from the API with enhanced retry logic
        async function fetchStats() {
            // Don't fetch if user is not registered
            if (!userSubscription.isRegistered) {
                return;
            }
            
            try {
                console.log(`Fetching stats from: ${STATS_URL}`);
                
                // Use our fetchWithRetry utility with better error handling
                const data = await fetchWithRetry(STATS_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    timeout: 10000, // 10-second timeout
                }, 2, 500); // 2 retries starting with 500ms backoff
                
                if (data && data.success) {
                    displayStats(data);
                } else {
                    throw new Error(data.message || 'Stats API returned success: false');
                }
            } catch (error) {
                console.error('Error fetching stats after all retries:', error);
                
                // If all retries failed, show error
                document.getElementById('stats-container').innerHTML = '<p>Statistics unavailable.</p>';
            }
        }

        // Function to display opportunities on the page
        function displayOpportunities(opportunities, filters = {}) {
            const container = document.getElementById('opportunities-list');
            
            if (opportunities.length === 0) {
                let messageHtml = '<p>No opportunities found matching your criteria.</p>';
                
                // If user selected a premium state but doesn't have access
                if (filters.state && filters.state !== 'social_media' && userSubscription.membershipLevel === 'free') {
                    messageHtml = `
                        <div class="locked-message">
                            <h3>Premium Content</h3>
                            <p>State-specific opportunities require a Supporter or Premium membership.</p>
                            <p>Supporters can access 3 state engines of their choice, while Premium members get access to all state engines.</p>
                            <a href="/membership" class="upgrade-button">Upgrade Now</a>
                        </div>
                    `;
                }
                
                container.innerHTML = messageHtml;
                return;
            }
            
            let html = '';
            
            // For non-registered users, show a preview with signup prompt
            if (!userSubscription.isRegistered) {
                html += `
                    <div class="preview-message">
                        <h3>Viewing Limited Preview</h3>
                        <p>Sign up to access all ${opportunities.length > 6 ? opportunities.length : ''} opportunities and use our AI-powered application tools.</p>
                        <button id="preview-signup-button" class="signup-button">Sign Up Free</button>
                    </div>
                `;
            }
            
            // Show the premium content notice if filtering by state with a free account
            if (filters.state && filters.state !== 'social_media' && filters.state !== '' && userSubscription.membershipLevel === 'free') {
                html += `
                    <div class="locked-message">
                        <h3>Viewing Limited Results</h3>
                        <p>You're seeing limited results. Upgrade to view more specialized opportunities in ${filters.state.replace('_', ' ')}.</p>
                        <a href="/membership" class="upgrade-button">Upgrade Now</a>
                    </div>
                `;
            }
            
            // Group opportunities by state/type
            const opportunitiesByType = {};
            opportunities.forEach(opp => {
                const type = opp.type || (opp.state ? opp.state.toLowerCase() : 'other');
                if (!opportunitiesByType[type]) {
                    opportunitiesByType[type] = [];
                }
                opportunitiesByType[type].push(opp);
            });
            
            // If we're filtering by a specific type, show those first
            if (filters.state && filters.state !== '') {
                const filteredType = filters.state.toLowerCase();
                if (opportunitiesByType[filteredType]) {
                    html += renderOpportunitiesGroup(filteredType, opportunitiesByType[filteredType]);
                    delete opportunitiesByType[filteredType]; // Remove so we don't show twice
                }
            }
            
            // Show social media opportunities first (available to all users)
            if (opportunitiesByType['social_media']) {
                html += renderOpportunitiesGroup('social_media', opportunitiesByType['social_media']);
                delete opportunitiesByType['social_media']; // Remove so we don't show twice
            }
            
            // Then show the rest of the groups
            Object.keys(opportunitiesByType).forEach(type => {
                html += renderOpportunitiesGroup(type, opportunitiesByType[type]);
            });
            
            container.innerHTML = html;
            
            // Initialize feedback widgets if user is authenticated
            initFeedbackWidgets();
        }
        
        // Show error messages to the user with improved retry functionality
        function showError(message) {
            const container = document.getElementById('opportunities-list');
            
            // Extract specific error messages and provide helpful context
            let errorText = message;
            let helpText = "Please try again in a moment.";
            
            if (message.includes('timeout') || message.includes('timed out')) {
                errorText = "Server connection timed out";
                helpText = "This might be due to a slow connection or temporary server load. Please try again.";
            } else if (message.includes('HTTP 404')) {
                errorText = "Resource not found";
                helpText = "The server couldn't find the requested data. This might be temporary.";
            } else if (message.includes('HTTP 502') || message.includes('HTTP 503')) {
                errorText = "Server temporarily unavailable";
                helpText = "The server is restarting or under maintenance. Please try again in a few moments.";
            } else if (message.includes('Network Error') || message.includes('Failed to fetch')) {
                errorText = "Network connection issue";
                helpText = "Please check your internet connection and try again.";
            }
            
            container.innerHTML = `
                <div class="error-container">
                    <h3>Something went wrong</h3>
                    <p>${errorText}</p>
                    <p class="help-text">${helpText}</p>
                    <div class="error-actions">
                        <button onclick="fetchOpportunities(getCurrentFilters())" class="retry-button">Try Again</button>
                        <button onclick="location.reload()" class="reload-button">Reload Page</button>
                    </div>
                </div>
            `;
            
            // Add error styling if it doesn't exist yet
            if (!document.getElementById('error-styles')) {
                const styles = document.createElement('style');
                styles.id = 'error-styles';
                styles.textContent = `
                    .error-container {
                        background-color: #fef1f1;
                        border: 1px solid #f5c2c7;
                        border-radius: 8px;
                        padding: 20px;
                        margin: 20px 0;
                        text-align: center;
                    }
                    .error-container h3 {
                        color: #842029;
                        margin-top: 0;
                    }
                    .error-container p {
                        color: #58151c;
                        margin-bottom: 8px;
                    }
                    .help-text {
                        font-size: 0.9em;
                        color: #6c757d;
                        margin-bottom: 15px;
                    }
                    .error-actions {
                        display: flex;
                        justify-content: center;
                        gap: 10px;
                        margin-top: 15px;
                    }
                    .retry-button {
                        background-color: #0d6efd;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        padding: 8px 16px;
                        cursor: pointer;
                        font-weight: bold;
                    }
                    .retry-button:hover {
                        background-color: #0b5ed7;
                    }
                    .reload-button {
                        background-color: #6c757d;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        padding: 8px 16px;
                        cursor: pointer;
                        font-weight: bold;
                    }
                    .reload-button:hover {
                        background-color: #5a6268;
                    }
                    .loading-container {
                        text-align: center;
                        padding: 40px 20px;
                    }
                    .loading-spinner {
                        border: 4px solid #f3f3f3;
                        border-top: 4px solid #3498db;
                        border-radius: 50%;
                        width: 40px;
                        height: 40px;
                        animation: spin 2s linear infinite;
                        margin: 0 auto 20px;
                    }
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `;
                document.head.appendChild(styles);
            }
        }
        
        // Helper function to get current filter values
        function getCurrentFilters() {
            return {
                keyword: document.getElementById('search-box').value.trim(),
                category: document.getElementById('category-filter').value,
                location: document.getElementById('location-filter').value,
                state: document.getElementById('state-filter').value
            };
        }
        
        // Initialize feedback widgets for all opportunities
        function initFeedbackWidgets() {
            // Get JWT token from localStorage - needed for authenticated API calls
            const token = localStorage.getItem('accessToken');
            
            // Only initialize if user is authenticated
            if (!token || !userSubscription.isRegistered) return;
            
            // Find all opportunity cards
            const opportunityCards = document.querySelectorAll('.opportunity-card:not(.locked-content)');
            
            opportunityCards.forEach(card => {
                // Find the feedback widget container
                const feedbackWidget = card.querySelector('.feedback-widget');
                
                if (feedbackWidget && feedbackWidget.id) {
                    // Extract opportunity ID from the widget ID (feedback-widget-{oppId})
                    const oppId = feedbackWidget.id.replace('feedback-widget-', '');
                    
                    // Initialize the widget with the opportunity ID and token
                    if (oppId && window.feedbackWidget) {
                        // Use setTimeout to ensure DOM is ready
                        setTimeout(() => {
                            window.feedbackWidget.init(oppId, token);
                        }, 100);
                    }
                }
            });
        }
        
        // Helper function to render a group of opportunities
        function renderOpportunitiesGroup(type, opportunities) {
            if (!opportunities || opportunities.length === 0) return '';
            
            // Format the group title nicely
            const groupTitle = type === 'social_media' ? 'Social Media Opportunities' : 
                            type.charAt(0).toUpperCase() + type.slice(1).replace('_', ' ') + ' Opportunities';
            
            let html = `<h2 class="group-header">${groupTitle}</h2>`;
            html += `<div class="opportunity-grid">`;
            
            // Check if this type needs premium membership
            const isPremiumContent = type !== 'social_media' && userSubscription.membershipLevel === 'free';
            
            opportunities.forEach(opp => {
                const scrapedDate = new Date(opp.scraped_date);
                const formattedDate = scrapedDate.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                // Determine if this is premium content that needs to be locked
                const cardClass = isPremiumContent ? 'opportunity-card locked-content' : 'opportunity-card';
                
                // Source information with state indicator
                let source = opp.source || 'Unknown Source';
                if (opp.state && opp.state !== 'National') {
                    source += ` <span class="source-state">${opp.state}</span>`;
                }
                
                // Premium indicator for state-specific content
                const isStateEngine = opp.state && opp.state !== 'National';
                const premiumIndicator = isStateEngine ? 
                    '<span class="premium-indicator">Premium</span>' : '';
                
                // Location formatting
                const locationDisplay = opp.location ? 
                    `<div class="opportunity-location">${opp.location}</div>` : '';
                
                // Description truncation
                let description = opp.description || 'No description available';
                if (description.length > 180) {
                    description = description.substring(0, 180) + '...';
                }
                
                // For all opportunities, add blurred content class if user just registered
                // This simulates the "signup to see details" requirement
                const blurClass = userSubscription.isNewUser ? 'blurred-content' : '';
                
                // Handle opportunity image - default to placeholder if no image provided
                let imageHtml = '';
                if (opp.image_url) {
                    // Extract base path and file extension
                    const imagePath = opp.image_url.split('.').slice(0, -1).join('.');
                    const imageExt = opp.image_url.split('.').pop() || 'jpg';
                    
                    imageHtml = `
                    <div class="opportunity-image">
                        <picture>
                            <source 
                                media="(max-width: 480px)" 
                                srcset="${imagePath}-small.${imageExt} 1x, ${imagePath}-small@2x.${imageExt} 2x"
                                type="image/${imageExt === 'jpg' ? 'jpeg' : imageExt}">
                            <source 
                                media="(max-width: 768px)" 
                                srcset="${imagePath}-medium.${imageExt} 1x, ${imagePath}-medium@2x.${imageExt} 2x"
                                type="image/${imageExt === 'jpg' ? 'jpeg' : imageExt}">
                            <img 
                                src="${imagePath}-large.${imageExt}" 
                                srcset="${imagePath}-large.${imageExt} 1x, ${imagePath}-large@2x.${imageExt} 2x"
                                alt="${opp.title}" 
                                loading="lazy" 
                                class="card-image ${blurClass}">
                        </picture>
                    </div>`;
                } else if (opp.image) {
                    // For backward compatibility with old data format
                    imageHtml = `
                    <div class="opportunity-image">
                        <img src="${opp.image}" alt="${opp.title}" loading="lazy" class="card-image ${blurClass}">
                    </div>`;
                } else {
                    // Use a placeholder image if none provided (optional - remove if not needed)
                    const placeholderUrl = "/assets/opportunity-placeholder.jpg";
                    imageHtml = `
                    <div class="opportunity-image placeholder">
                        <img src="${placeholderUrl}" alt="Opportunity placeholder" loading="lazy" class="card-image ${blurClass}">
                    </div>`;
                }
                
                html += `
                    <div class="${cardClass}">
                        <div class="card-header">
                            <div class="opportunity-source">
                                ${source} ${premiumIndicator}
                            </div>
                            <h3 class="opportunity-title ${blurClass}">${opp.title}</h3>
                        </div>
                        ${imageHtml}
                        <div class="card-body ${blurClass}">
                            ${locationDisplay}
                            <div class="opportunity-description">${description}</div>
                            <div id="feedback-widget-${opp.id}" class="feedback-widget"></div>
                        </div>
                        <div class="card-footer">
                            <div class="opportunity-meta">
                                Added on ${formattedDate}
                            </div>
                            <a href="${opp.url}" class="opportunity-link" target="_blank">
                                <span class="button-text" data-ai-tooltip="application-autofill" data-tooltip-position="top" data-premium="true">Auto-Apply with AI</span>
                            </a>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            return html;
        }

        // Function to display stats on the page
        function displayStats(data) {
            const container = document.getElementById('stats-container');
            
            let html = '<h3>Opportunity Statistics</h3>';
            
            if (data.total_count) {
                html += `
                    <ul>
                        <li><span>Total Opportunities:</span> <span>${data.total_count}</span></li>
                `;
                
                // Recent additions
                if (Object.keys(data.daily_counts).length > 0) {
                    // Sort dates in descending order
                    const sortedDates = Object.keys(data.daily_counts).sort().reverse().slice(0, 5);
                    
                    sortedDates.forEach(date => {
                        const count = data.daily_counts[date];
                        const formattedDate = new Date(date).toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric'
                        });
                        
                        html += `<li><span>Added on ${formattedDate}:</span> <span>${count}</span></li>`;
                    });
                }
                
                html += `</ul>`;
            } else {
                html += '<p>No statistics available at this time.</p>';
            }
            
            container.innerHTML = html;
        }

        // Already defined a more comprehensive showError function above

        // Search and filter functionality
        function applyFilters() {
            const keyword = document.getElementById('search-box').value.trim();
            const category = document.getElementById('category-filter').value;
            const location = document.getElementById('location-filter').value;
            const state = document.getElementById('state-filter').value;
            
            fetchOpportunities({
                keyword: keyword,
                category: category,
                location: location,
                state: state
            });
        }
        
        // Add event listeners to all filter inputs
        document.getElementById('search-box').addEventListener('input', applyFilters);
        document.getElementById('category-filter').addEventListener('change', applyFilters);
        document.getElementById('location-filter').addEventListener('change', applyFilters);
        document.getElementById('state-filter').addEventListener('change', applyFilters);

        // Add event listener for preview signup button (dynamically added)
        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'preview-signup-button') {
                // Show signup form by scrolling to it
                document.getElementById('signup-container').scrollIntoView({ behavior: 'smooth' });
                // Highlight the form with a brief animation
                document.getElementById('signup-container').classList.add('highlight-signup');
                setTimeout(() => {
                    document.getElementById('signup-container').classList.remove('highlight-signup');
                }, 1500);
                
                // Focus the email input field
                setTimeout(() => {
                    document.getElementById('email-input').focus();
                }, 800);
            }
        });

        // On page load, check if the user is already registered
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already registered
            checkRegistrationStatus();
            
            // If not registered, start with a preview of opportunities
            if (!userSubscription.isRegistered) {
                fetchOpportunities({});
            }
            
            // Update membership display
            const levelIndicator = document.querySelector('.level-indicator');
            if (levelIndicator) {
                levelIndicator.textContent = userSubscription.membershipLevel.charAt(0).toUpperCase() + 
                                            userSubscription.membershipLevel.slice(1);
                
                // Change indicator style based on membership level
                if (userSubscription.membershipLevel === 'supporter') {
                    levelIndicator.style.backgroundColor = '#FFF3E0';
                    levelIndicator.style.color = '#E67E22';
                } else if (userSubscription.membershipLevel === 'premium') {
                    levelIndicator.style.backgroundColor = '#E8EAF6';
                    levelIndicator.style.color = '#3F51B5';
                }
            }
        });
    </script>
    
    <!-- AI Tooltips Script -->
    <script src="/static/js/ai-tooltips.js"></script>
    <script src="/static/js/feedback-widget.js"></script>
    
    <!-- Mobile Navigation -->
    {% include "includes/mobile_nav.html" %}
</body>
</html>